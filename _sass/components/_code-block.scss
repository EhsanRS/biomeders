// ============================================
// CODE BLOCK COMPONENT
// Syntax highlighting with copy button
// ============================================

@use '../abstracts/mixins' as *;

// Code block wrapper (generated by Rouge)
.highlight {
  position: relative;
  margin: var(--space-6) 0;
  border-radius: var(--radius-lg);
  overflow: hidden;

  pre {
    margin: 0;
    padding: var(--space-4);
    overflow-x: auto;
    background-color: var(--bg-code);
    border: 1px solid var(--border-default);
    border-radius: var(--radius-lg);
    @include code-text;
    font-size: var(--text-sm);
    line-height: var(--leading-relaxed);

    code {
      padding: 0;
      background: none;
      color: var(--text-primary);
      font-size: inherit;
    }
  }

  // Scrollbar styling
  pre::-webkit-scrollbar {
    height: 8px;
  }

  pre::-webkit-scrollbar-track {
    background: var(--bg-muted);
    border-radius: 4px;
  }

  pre::-webkit-scrollbar-thumb {
    background: var(--border-strong);
    border-radius: 4px;

    &:hover {
      background: var(--text-muted);
    }
  }
}

// Copy button
.code-copy-btn {
  @include button-reset;
  position: absolute;
  top: var(--space-2);
  right: var(--space-2);
  display: flex;
  align-items: center;
  gap: var(--space-1);
  padding: var(--space-1) var(--space-2);
  font-size: var(--text-xs);
  font-family: var(--font-primary);
  color: var(--text-muted);
  background-color: var(--bg-surface);
  border: 1px solid var(--border-default);
  border-radius: var(--radius-sm);
  opacity: 0;
  @include transition-opacity;
  @include transition-colors;

  .highlight:hover & {
    opacity: 1;
  }

  &:hover {
    color: var(--text-primary);
    background-color: var(--bg-muted);
  }

  &:focus-visible {
    opacity: 1;
    @include focus-ring;
  }

  // Copied state
  &.copied {
    color: var(--success);
    border-color: var(--success);
  }

  svg {
    width: 14px;
    height: 14px;
  }
}

// Language label
.code-language {
  position: absolute;
  top: 0;
  right: var(--space-12);
  padding: var(--space-1) var(--space-2);
  font-size: var(--text-xs);
  font-family: var(--font-code);
  color: var(--text-muted);
  background-color: var(--bg-muted);
  border-bottom-left-radius: var(--radius-sm);
  border-bottom-right-radius: var(--radius-sm);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

// Line numbers (optional)
.highlight[data-line-numbers="true"] {
  pre {
    padding-left: var(--space-12);
  }

  .line-numbers {
    position: absolute;
    top: 0;
    left: 0;
    width: var(--space-10);
    padding: var(--space-4) var(--space-2);
    text-align: right;
    color: var(--text-muted);
    background-color: var(--bg-muted);
    border-right: 1px solid var(--border-default);
    user-select: none;
    font-size: var(--text-sm);
    line-height: var(--leading-relaxed);
  }
}

// Inline code (not in a block)
code:not(.highlight code) {
  @include code-text;
  padding: 0.125em 0.375em;
  border-radius: var(--radius-sm);
  background-color: var(--bg-code);
  color: var(--code-keyword);
  word-break: break-word;
}

// Filename header
.code-filename {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  background-color: var(--bg-muted);
  border: 1px solid var(--border-default);
  border-bottom: none;
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  font-size: var(--text-xs);
  font-family: var(--font-code);
  color: var(--text-secondary);

  + .highlight {
    margin-top: 0;

    pre {
      border-top-left-radius: 0;
      border-top-right-radius: 0;
    }
  }

  svg {
    width: 14px;
    height: 14px;
    opacity: 0.7;
  }
}

// Rouge syntax highlighting tokens
.highlight {
  // Comments
  .c, .c1, .cm, .cs, .cp, .cpf {
    color: var(--code-comment);
    font-style: italic;
  }

  // Keywords
  .k, .kd, .kn, .kp, .kr, .kt, .kc {
    color: var(--code-keyword);
  }

  // Strings
  .s, .s1, .s2, .sb, .sc, .sd, .se, .sh, .si, .sx, .sr, .ss {
    color: var(--code-string);
  }

  // Numbers
  .m, .mf, .mh, .mi, .mo, .il, .mb, .mx {
    color: var(--code-number);
  }

  // Functions
  .nf, .fm, .nc {
    color: var(--code-function);
  }

  // Variables
  .nv, .vc, .vg, .vi, .vm {
    color: var(--code-variable);
  }

  // Operators
  .o, .ow {
    color: var(--code-operator);
  }

  // Punctuation
  .p {
    color: var(--text-secondary);
  }

  // Classes, types
  .nc, .nn, .ne {
    color: var(--code-class);
  }

  // Properties
  .na, .py {
    color: var(--code-property);
  }

  // Diff
  .gd {
    color: var(--error);
    background-color: var(--error-bg);
  }

  .gi {
    color: var(--success);
    background-color: var(--success-bg);
  }

  // Generic
  .ge { font-style: italic; }
  .gs { font-weight: bold; }
  .gh { font-weight: bold; }
  .gu { color: var(--text-muted); }
}
